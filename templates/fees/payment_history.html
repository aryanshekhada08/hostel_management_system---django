{% extends "dashboards/student/base.html" %}
{% block title %}Payment History{% endblock %}

{% block student_content %}

<div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
    <div class="absolute top-[10%] right-[5%] w-64 h-64 bg-emerald-200 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
    <div class="absolute bottom-[10%] left-[20%] w-64 h-64 bg-indigo-200 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
</div>

<div class="mb-8">
    <h2 class="text-3xl font-black text-slate-900 tracking-tight">Payment History</h2>
    <p class="text-slate-500 text-sm font-medium">Keep track of your hostel fees and download receipts.</p>
</div>

<div class="bg-white/70 backdrop-blur-xl rounded-[2rem] shadow-2xl shadow-slate-200/50 border border-white/60 overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full border-collapse" id="payments-table">
            <thead>
                <tr class="bg-slate-900/5 border-b border-slate-200/50 text-xs font-black text-slate-500 uppercase tracking-widest">
                    <th class="p-5 text-left">Date</th>
                    <th class="p-5 text-left">Amount</th>
                    <th class="p-5 text-left">Method</th>
                    <th class="p-5 text-left">Transaction ID</th>
                    <th class="p-5 text-right">Receipt</th>
                </tr>
            </thead>
            <tbody id="payment-body">
                {% for payment in payments %}
                <tr class="payment-row group hover:bg-white/50 transition-all border-b border-slate-100/50 last:border-0">
                    <td class="p-5">
                        <div class="font-bold text-slate-700 text-sm">{{ payment.payment_date|date:"M d, Y" }}</div>
                        <div class="text-[10px] text-slate-400 font-bold uppercase">{{ payment.payment_date|date:"H:i A" }}</div>
                    </td>
                    <td class="p-5">
                        <span class="px-3 py-1 bg-emerald-50 text-emerald-600 rounded-lg font-black text-sm border border-emerald-100">
                            â‚¹{{ payment.amount }}
                        </span>
                    </td>
                    <td class="p-5">
                        <span class="text-xs font-bold text-slate-600 bg-slate-100 px-2 py-1 rounded-md">{{ payment.payment_method }}</span>
                    </td>
                    <td class="p-5">
                        <code class="text-[10px] text-slate-400 font-mono bg-slate-50 px-2 py-1 rounded">{{ payment.transaction_id }}</code>
                    </td>
                    <td class="p-5 text-right">
                        <a href="{% url 'download_receipt' payment.id %}"
                           class="inline-flex items-center gap-2 px-4 py-2 bg-slate-900 text-white rounded-xl text-xs font-bold hover:bg-indigo-600 transition-all shadow-lg hover:shadow-indigo-200">
                           <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                           Download
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="p-12 text-center">
                        <div class="text-4xl mb-3">ðŸ’¸</div>
                        <p class="text-slate-400 font-bold">No payment records found.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="p-6 bg-slate-50/50 border-t border-slate-200/50 flex flex-col md:flex-row items-center justify-between gap-4">
        <p id="page-info" class="text-[10px] font-black text-slate-400 uppercase tracking-widest">
            Showing 1 to 5 of {{ payments|length }} entries
        </p>
        <div id="pagination-controls" class="flex items-center gap-2">
            </div>
    </div>
</div>

<style>
    @keyframes blob {
        0% { transform: translate(0px, 0px) scale(1); }
        33% { transform: translate(30px, -40px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
        100% { transform: translate(0px, 0px) scale(1); }
    }
    .animate-blob { animation: blob 8s infinite; }
    .animation-delay-2000 { animation-delay: 2s; }

    .page-btn {
        padding: 6px 12px;
        font-size: 11px;
        font-weight: 800;
        border-radius: 10px;
        background: white;
        border: 1px solid #e2e8f0;
        color: #64748b;
        transition: all 0.2s;
    }
    .page-btn.active {
        background: #0f172a;
        color: white;
        border-color: #0f172a;
    }
    .page-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const rowsPerPage = 5;
    const body = document.getElementById("payment-body");
    const rows = Array.from(body.getElementsByClassName("payment-row"));
    const controls = document.getElementById("pagination-controls");
    const info = document.getElementById("page-info");
    
    let currentPage = 1;
    const totalPages = Math.ceil(rows.length / rowsPerPage);

    function updateTable(page) {
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        rows.forEach((row, idx) => {
            row.style.display = (idx >= start && idx < end) ? "table-row" : "none";
        });

        renderButtons();
        const showingTo = Math.min(end, rows.length);
        info.innerText = `Showing ${rows.length > 0 ? start + 1 : 0} to ${showingTo} of ${rows.length} entries`;
    }

    function renderButtons() {
        controls.innerHTML = "";
        
        const prev = document.createElement("button");
        prev.innerHTML = "â†";
        prev.className = "page-btn";
        prev.disabled = currentPage === 1;
        prev.onclick = () => { currentPage--; updateTable(currentPage); };
        controls.appendChild(prev);

        for (let i = 1; i <= totalPages; i++) {
            const btn = document.createElement("button");
            btn.innerText = i;
            btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
            btn.onclick = () => { currentPage = i; updateTable(currentPage); };
            controls.appendChild(btn);
        }

        const next = document.createElement("button");
        next.innerHTML = "â†’";
        next.className = "page-btn";
        next.disabled = currentPage === totalPages;
        next.onclick = () => { currentPage++; updateTable(currentPage); };
        controls.appendChild(next);
    }

    if (rows.length > 0) updateTable(1);
});
</script>

{% endblock %}